services:
  saml-ldap-bridge:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: saml-ldap-bridge
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=development
      - PYTHONPATH=/app
      - DEBUG
      - SECRET_KEY
      - SAML_SP_ENTITY_ID
      - SAML_SP_ACS_URL
      - SAML_SP_SLS_URL
      - SAML_IDP_ENTITY_ID
      - SAML_IDP_SSO_URL
      - SAML_IDP_X509_CERT
      - LDAP_HOST
      - LDAP_PORT
      - LDAP_BASE_DN
      - LDAP_BIND_DN
      - LDAP_BIND_PASSWORD
      - TEMP_CREDENTIAL_CLEANUP_INTERVAL
      - TEMP_CREDENTIAL_EXPIRY
      - SSL_CERT_PATH
      - SSL_KEY_PATH
    volumes:
      - ./app:/app:rw
    restart: unless-stopped
  openldap:
    image: osixia/openldap:1.5.0
    container_name: openldap
    environment:
      - CONTAINER_LOG_LEVEL=5
      - LDAP_ORGANISATION=Example Org
      - LDAP_DOMAIN=outlook.de
      - LDAP_ADMIN_PASSWORD=admin
      - LDAP_TLS=false
      - LDAP_REMOVE_CONFIG_AFTER_SETUP=false # Keeps config files intact
    ports:
      - "389:389"
    volumes:
      - ldap-data:/var/lib/ldap
      - ldap-config:/etc/ldap/slapd.d
    restart: unless-stopped

volumes:
  ldap-data:
  ldap-config:
